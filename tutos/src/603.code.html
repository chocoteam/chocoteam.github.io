<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Code &mdash; choco-tuto 1.0.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="choco-tuto 1.0.0 documentation" href="../index.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="code">
<span id="al-code"></span><h1>Code<a class="headerlink" href="#code" title="Permalink to this headline">¶</a></h1>
<div class="section" id="building-dfas">
<h2>Building DFAs<a class="headerlink" href="#building-dfas" title="Permalink to this headline">¶</a></h2>
<p>Before describing the model, which is very compact, we will see ho the DFAs can be build.</p>
<p>We will focus on a single sequence: <cite>{1, 2, 3}</cite>.</p>
<div class="section" id="regexp-way">
<h3>Regexp way<a class="headerlink" href="#regexp-way" title="Permalink to this headline">¶</a></h3>
<p>The regular expression that encodes the sequence is <cite>0*10+1{2}0+1{3}0*</cite>:</p>
<ul>
<li><p class="first"><cite>0*</cite> the word can start with unbounded number of <cite>0</cite> (<cite>*</cite> means zero or more times)</p>
</li>
<li><p class="first"><cite>10+</cite> the first block of 1 is followed by at least one <cite>0</cite> (<cite>+</cite> means one or more times)</p>
</li>
<li><dl class="first docutils">
<dt><cite>1{2}0+</cite></dt>
<dd><ul class="first last simple">
<li>the second block of 2 (<cite>a{n}</cite>  means <cite>a</cite> appears exactly <cite>n</cite> times)</li>
<li>is followed by at least one <cite>0</cite></li>
</ul>
</dd>
</dl>
</li>
<li><p class="first"><cite>1{3}0*</cite> the third &#8211; and last &#8211; block of size 3 is followed by zero or more <cite>0</cite>.
Indeed, this the last block of the sequence, so there cannot be other <cite>1</cite> after and <a href="#id1"><span class="problematic" id="id2">`</span></a>0`s are optional.</p>
</li>
</ul>
<p>Starting and ending <a href="#id3"><span class="problematic" id="id4">`</span></a>0`s are optional but it has to be defined in the regexp, otherwise some valid words
may be skipped.</p>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p class="last">In Choco, DFAs only accept integer as character.
<cite>0*a+</cite> is not a valid grammar, there is no conversion <cite>Character</cite> (java term) to <cite>Integer</cite>.
But, numbers are allowed, not only digits. Indeed, some variables can take value greater than <cite>9</cite> !
In that case, number are declared using the specific characters <cite>&lt;</cite> and <cite>&gt;</cite>.
For example: <cite>0*&lt;11&gt;&lt;22&gt;0*</cite> will produce words like <cite>00112200</cite> or <cite>1122</cite> but no <cite>0120</cite>.</p>
</div>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">private</span> <span class="kt">void</span> <span class="nf">dfa</span><span class="o">(</span><span class="n">BoolVar</span><span class="o">[]</span> <span class="n">cells</span><span class="o">,</span> <span class="kt">int</span><span class="o">[]</span> <span class="n">rest</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">StringBuilder</span> <span class="n">regexp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">(</span><span class="s">&quot;0*&quot;</span><span class="o">);</span>
    <span class="kt">int</span> <span class="n">m</span> <span class="o">=</span> <span class="n">rest</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">m</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
        <span class="n">regexp</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="sc">&#39;1&#39;</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="sc">&#39;{&#39;</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="n">rest</span><span class="o">[</span><span class="n">i</span><span class="o">]).</span><span class="na">append</span><span class="o">(</span><span class="sc">&#39;}&#39;</span><span class="o">);</span>
        <span class="n">regexp</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="sc">&#39;0&#39;</span><span class="o">);</span>
        <span class="n">regexp</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">?</span> <span class="sc">&#39;*&#39;</span> <span class="o">:</span> <span class="sc">&#39;+&#39;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="n">IAutomaton</span> <span class="n">auto</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FiniteAutomaton</span><span class="o">(</span><span class="n">regexp</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
    <span class="n">model</span><span class="o">.</span><span class="na">regular</span><span class="o">(</span><span class="n">cells</span><span class="o">,</span> <span class="n">auto</span><span class="o">).</span><span class="na">post</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="constructive-way">
<h3>Constructive way<a class="headerlink" href="#constructive-way" title="Permalink to this headline">¶</a></h3>
<p>The constructive way requires to declare all states of the automaton and links together with transitions.
A transition corresponds to a character in the word, and a state is <em>between</em> two characters of the word.</p>
<p>So there is a need of an initial state from which (through an outgoing  transition) the first character of the word will be provided.
And at least one final state to which (through an ingoing transition) the last character of the word will be provided.</p>
<p>We note <span class="math">\(s_i\)</span> the initial state.
The first character can either be a 0 or a 1, there will be two transitions outgoing from <span class="math">\(s_i\)</span>.
Then, transition from <span class="math">\(s_i\)</span> producing <cite>0</cite> will go to <span class="math">\(i_0\)</span> (first transition).
And transition from <span class="math">\(s_i\)</span> producing <cite>1</cite> will go to <span class="math">\(i_1\)</span> (second transition).
<span class="math">\(i_0\)</span> points to itself providing <cite>0`s (third transition).
Outgoing transition from :math:`i_1</cite> goes to <span class="math">\(i_2\)</span> and produces <cite>0</cite> (fourth transition).
Two transitions outgoes from <span class="math">\(i_2\)</span>:
one goes to itself (fifth transition, producing <cite>0</cite>),
one goes to <span class="math">\(i_3\)</span> (sixth transition, producing <cite>1</cite>).
<span class="math">\(i_3\)</span> goes to <span class="math">\(i_4`(seventh transition) and produce `1\)</span>.
<span class="math">\(i_4\)</span> goes to <span class="math">\(i_5`(eighth transition) and produce `0\)</span>.
And so on.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Even though regexp appears to be easy to use, the constructive way is more expressive.</p>
</div>
</div>
</div>
<div class="section" id="the-entire-code">
<h2>The entire code<a class="headerlink" href="#the-entire-code" title="Permalink to this headline">¶</a></h2>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// number of columns</span>
<span class="kt">int</span> <span class="n">N</span> <span class="o">=</span> <span class="mi">15</span><span class="o">;</span>
<span class="c1">// number of rows</span>
<span class="kt">int</span> <span class="n">M</span> <span class="o">=</span> <span class="mi">15</span><span class="o">;</span>
<span class="c1">// sequence of shaded blocks</span>
<span class="kt">int</span><span class="o">[][][]</span> <span class="n">BLOCKS</span> <span class="o">=</span>
        <span class="k">new</span> <span class="kt">int</span><span class="o">[][][]{{</span>
                <span class="o">{</span><span class="mi">2</span><span class="o">},</span>
                <span class="o">{</span><span class="mi">4</span><span class="o">,</span> <span class="mi">2</span><span class="o">},</span>
                <span class="o">{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">4</span><span class="o">},</span>
                <span class="o">{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">},</span>
                <span class="o">{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">},</span>
                <span class="o">{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">},</span>
                <span class="o">{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">},</span>
                <span class="o">{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">},</span>
                <span class="o">{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">1</span><span class="o">},</span>
                <span class="o">{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">1</span><span class="o">},</span>
                <span class="o">{</span><span class="mi">2</span><span class="o">,</span> <span class="mi">1</span><span class="o">},</span>
                <span class="o">{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">},</span>
                <span class="o">{</span><span class="mi">2</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">},</span>
                <span class="o">{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">},</span>
                <span class="o">{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">1</span><span class="o">},</span>
        <span class="o">},</span> <span class="o">{</span>
                <span class="o">{</span><span class="mi">3</span><span class="o">},</span>
                <span class="o">{</span><span class="mi">3</span><span class="o">},</span>
                <span class="o">{</span><span class="mi">10</span><span class="o">},</span>
                <span class="o">{</span><span class="mi">2</span><span class="o">},</span>
                <span class="o">{</span><span class="mi">2</span><span class="o">},</span>
                <span class="o">{</span><span class="mi">8</span><span class="o">,</span> <span class="mi">2</span><span class="o">},</span>
                <span class="o">{</span><span class="mi">2</span><span class="o">},</span>
                <span class="o">{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">1</span><span class="o">},</span>
                <span class="o">{</span><span class="mi">2</span><span class="o">,</span> <span class="mi">1</span><span class="o">},</span>
                <span class="o">{</span><span class="mi">7</span><span class="o">},</span>
                <span class="o">{</span><span class="mi">2</span><span class="o">},</span>
                <span class="o">{</span><span class="mi">2</span><span class="o">},</span>
                <span class="o">{</span><span class="mi">10</span><span class="o">},</span>
                <span class="o">{</span><span class="mi">3</span><span class="o">},</span>
                <span class="o">{</span><span class="mi">2</span><span class="o">}}};</span>

<span class="n">Model</span> <span class="n">model</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Model</span><span class="o">(</span><span class="s">&quot;Nonogram&quot;</span><span class="o">);</span>
<span class="c1">// Variables declaration</span>
<span class="n">BoolVar</span><span class="o">[][]</span> <span class="n">cells</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">boolVarMatrix</span><span class="o">(</span><span class="s">&quot;c&quot;</span><span class="o">,</span> <span class="n">N</span><span class="o">,</span> <span class="n">M</span><span class="o">);</span>
<span class="c1">// Constraint declaration</span>
<span class="c1">// one regular per row</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">M</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
    <span class="n">dfa</span><span class="o">(</span><span class="n">cells</span><span class="o">[</span><span class="n">i</span><span class="o">],</span> <span class="n">BLOCKS</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="n">i</span><span class="o">],</span> <span class="n">model</span><span class="o">);</span>
<span class="o">}</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">N</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
    <span class="n">dfa</span><span class="o">(</span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">getColumn</span><span class="o">(</span><span class="n">cells</span><span class="o">,</span> <span class="n">j</span><span class="o">),</span> <span class="n">BLOCKS</span><span class="o">[</span><span class="mi">1</span><span class="o">][</span><span class="n">j</span><span class="o">],</span> <span class="n">model</span><span class="o">);</span>
<span class="o">}</span>
<span class="k">if</span><span class="o">(</span><span class="n">model</span><span class="o">.</span><span class="na">getSolver</span><span class="o">().</span><span class="na">solve</span><span class="o">()){</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">cells</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&quot;\t&quot;</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">cells</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">length</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="n">cells</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span><span class="o">].</span><span class="na">getValue</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">?</span> <span class="s">&quot;#&quot;</span> <span class="o">:</span> <span class="s">&quot; &quot;</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&quot;\n&quot;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="things-to-remember">
<h2>Things to remember<a class="headerlink" href="#things-to-remember" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Regular constraint constructs valid fix-sized words on the basis of a vocabulary and a grammar.</li>
<li>A deterministic finite automaton can either be build with a regular expression or step-by-step.</li>
<li>Regular constraints are very useful when patterns occur in solutions.
For example, when dealing with shifts on a personnal scheduling problem:
for example: &#8220;a nurse doesn&#8217;t do a late night shift followed by a day shift the next day&#8221;.</li>
</ul>
<p><a class="reference external" href="602.mathmodel.html">&lt;&lt;mathematical model</a></p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">choco-tuto</a></h1>





<p>
<iframe src="https://ghbtns.com/github-btn.html?user=&repo=&type=watch&count=true&size=large"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>




<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="001.introduction.html">Introduction to choco-tuto</a></li>
<li class="toctree-l1"><a class="reference internal" href="002.history.html">Choco, a constraint programming java library</a></li>
<li class="toctree-l1"><a class="reference internal" href="003.installation.html">Installation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="201.firstexample.html">A first example</a></li>
<li class="toctree-l1"><a class="reference internal" href="202.objects.html">Objects in Choco</a></li>
<li class="toctree-l1"><a class="reference internal" href="203.firstexample2.html">Playing around with 8-queens puzzle</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="301.description.html">Verbal arithmetic</a></li>
<li class="toctree-l1"><a class="reference internal" href="401.description.html">Warehouse Location Problem</a></li>
<li class="toctree-l1"><a class="reference internal" href="501.description.html">Aircraft Landing Problem</a></li>
<li class="toctree-l1"><a class="reference internal" href="601.description.html">Nonogram</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Charles Prud'homme.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.7</a>
      
      |
      <a href="../_sources/src/603.code.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>