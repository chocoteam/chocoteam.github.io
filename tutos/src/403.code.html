<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Code &mdash; choco-tuto 1.0.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="choco-tuto 1.0.0 documentation" href="../index.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="code">
<h1>Code<a class="headerlink" href="#code" title="Permalink to this headline">¶</a></h1>
<div class="section" id="a-model">
<h2>A model<a class="headerlink" href="#a-model" title="Permalink to this headline">¶</a></h2>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// load parameters</span>
<span class="c1">// ...</span>
<span class="c1">// A new model instance</span>
<span class="n">Model</span> <span class="n">model</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Model</span><span class="o">(</span><span class="s">&quot;WarehouseLocation&quot;</span><span class="o">);</span>

<span class="c1">// VARIABLES</span>
<span class="c1">// a warehouse is either open or closed</span>
<span class="n">BoolVar</span><span class="o">[]</span> <span class="n">open</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">boolVarArray</span><span class="o">(</span><span class="s">&quot;o&quot;</span><span class="o">,</span> <span class="n">W</span><span class="o">);</span>
<span class="c1">// which warehouse supplies a store</span>
<span class="n">IntVar</span><span class="o">[]</span> <span class="n">supplier</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">intVarArray</span><span class="o">(</span><span class="s">&quot;supplier&quot;</span><span class="o">,</span> <span class="n">S</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="n">W</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
<span class="c1">// supplying cost per store</span>
<span class="n">IntVar</span><span class="o">[]</span> <span class="n">cost</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">intVarArray</span><span class="o">(</span><span class="s">&quot;cost&quot;</span><span class="o">,</span> <span class="n">S</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">96</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
<span class="c1">// Total of all costs</span>
<span class="n">IntVar</span> <span class="n">tot_cost</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">intVar</span><span class="o">(</span><span class="s">&quot;C&quot;</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">99999</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>

<span class="c1">// CONSTRAINTS</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">S</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
    <span class="c1">// a warehouse is &#39;open&#39;, if it supplies to a store</span>
    <span class="n">model</span><span class="o">.</span><span class="na">element</span><span class="o">(</span><span class="n">model</span><span class="o">.</span><span class="na">intVar</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span> <span class="n">open</span><span class="o">,</span> <span class="n">supplier</span><span class="o">[</span><span class="n">j</span><span class="o">],</span> <span class="mi">1</span><span class="o">).</span><span class="na">post</span><span class="o">();</span>
    <span class="c1">// Compute &#39;cost&#39; for each store</span>
    <span class="n">model</span><span class="o">.</span><span class="na">element</span><span class="o">(</span><span class="n">cost</span><span class="o">[</span><span class="n">j</span><span class="o">],</span> <span class="n">P</span><span class="o">[</span><span class="n">j</span><span class="o">],</span> <span class="n">supplier</span><span class="o">[</span><span class="n">j</span><span class="o">],</span> <span class="mi">1</span><span class="o">).</span><span class="na">post</span><span class="o">();</span>
<span class="o">}</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">W</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
    <span class="c1">// additional variable &#39;occ&#39; is created on the fly</span>
    <span class="c1">// its domain includes the constraint on capacity</span>
    <span class="n">IntVar</span> <span class="n">occ</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">intVar</span><span class="o">(</span><span class="s">&quot;occur_&quot;</span> <span class="o">+</span> <span class="n">i</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">K</span><span class="o">[</span><span class="n">i</span><span class="o">],</span> <span class="kc">true</span><span class="o">);</span>
    <span class="c1">// for-loop starts at 0, warehouse index starts at 1</span>
    <span class="c1">// =&gt; we count occurrences of (i+1) in &#39;supplier&#39;</span>
    <span class="n">model</span><span class="o">.</span><span class="na">count</span><span class="o">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="o">,</span> <span class="n">supplier</span><span class="o">,</span> <span class="n">occ</span><span class="o">).</span><span class="na">post</span><span class="o">();</span>
    <span class="c1">// redundant link between &#39;occ&#39; and &#39;open&#39; for better propagation</span>
    <span class="n">occ</span><span class="o">.</span><span class="na">ge</span><span class="o">(</span><span class="n">open</span><span class="o">[</span><span class="n">i</span><span class="o">]).</span><span class="na">post</span><span class="o">();</span>
<span class="o">}</span>
<span class="c1">// Prepare the constraint that maintains &#39;tot_cost&#39;</span>
<span class="kt">int</span><span class="o">[]</span> <span class="n">coeffs</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">W</span> <span class="o">+</span> <span class="n">S</span><span class="o">];</span>
<span class="n">Arrays</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">coeffs</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">W</span><span class="o">,</span> <span class="n">C</span><span class="o">);</span>
<span class="n">Arrays</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">coeffs</span><span class="o">,</span> <span class="n">W</span><span class="o">,</span> <span class="n">W</span> <span class="o">+</span> <span class="n">S</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
<span class="c1">// then post it</span>
<span class="n">model</span><span class="o">.</span><span class="na">scalar</span><span class="o">(</span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">open</span><span class="o">,</span> <span class="n">cost</span><span class="o">),</span> <span class="n">coeffs</span><span class="o">,</span> <span class="s">&quot;=&quot;</span><span class="o">,</span> <span class="n">tot_cost</span><span class="o">).</span><span class="na">post</span><span class="o">();</span>
</pre></div>
</td></tr></table></div>
<p>The last parameter of the element constraints (line 19 and 21) indicates an offset
It enables to adapt the index range wrt to the domain of the variable: here supplier variables lower bound is 1.
But, open array index starts at 0 and an offset is needed to match supplier with open array.
In other words, first <em>element</em> constraint states that <cite>open[supplier[s] - o] = 1</cite> where <cite>o</cite> is set to 1.</p>
</div>
<div class="section" id="a-search-strategy">
<h2>A search strategy<a class="headerlink" href="#a-search-strategy" title="Permalink to this headline">¶</a></h2>
<p>Since the problem is hard to solve, defining an adapted strategy is a key to success.
Among all declared variables, the ones that holds the problem are &#8216;open&#8217; and &#8216;supplier&#8217;:
deciding on these variables has a great effect on the size of the search space reduction.
They are named after that effect as <em>decision variables</em>.</p>
<p>A good strategy for that problem is to select, among decisions variables, the one with the smallest domain first.
If two variables or more have the smallest domain size, <em>ties</em> are broken randomly.
Then, the value in the middle of the domain of the selected variable is assigned to it, with a floor rounding policy
(the closest value greater or equal to the middle value is returned).</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">Solver</span> <span class="n">solver</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">getSolver</span><span class="o">();</span>
<span class="n">solver</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">SearchStrategyFactory</span><span class="o">.</span><span class="na">intVarSearch</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">VariableSelectorWithTies</span><span class="o">&lt;&gt;(</span>
                <span class="k">new</span> <span class="n">FirstFail</span><span class="o">(</span><span class="n">model</span><span class="o">),</span>
                <span class="k">new</span> <span class="n">Smallest</span><span class="o">()),</span>
        <span class="n">ValSelectorFactory</span><span class="o">.</span><span class="na">midIntVal</span><span class="o">(</span><span class="kc">false</span><span class="o">),</span>
        <span class="n">ArrayUtils</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">supplier</span><span class="o">,</span> <span class="n">cost</span><span class="o">,</span> <span class="n">open</span><span class="o">))</span>
<span class="o">);</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="the-resolution-objective">
<h2>The resolution objective<a class="headerlink" href="#the-resolution-objective" title="Permalink to this headline">¶</a></h2>
<p>The objective is to minimize &#8216;tot_cost&#8217;.</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// Find a solution that minimizes &#39;tot_cost&#39;</span>
<span class="n">Solution</span> <span class="n">best</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="na">findOptimalSolution</span><span class="o">(</span><span class="n">tot_cost</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
</pre></div>
</td></tr></table></div>
<p>This method attempts to find the optimal solution.</p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">Finding an optimal solution goes like this:
anytime a solution is found, a <em>cut</em> is posted on the objective variable to forbid worst
or same value solutions to be found.
When a cut is so strong that no better solution is found, the last one is the optimal one (if we consider that no
search limits was defined).
The cut process is entirely managed by the solver.</p>
</div>
<p>Alternatively, the search loop can be unfold</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="na">setObjective</span><span class="o">(</span><span class="n">ResolutionPolicy</span><span class="o">.</span><span class="na">MINIMIZE</span><span class="o">,</span> <span class="n">tot_cost</span><span class="o">);</span>
<span class="k">while</span><span class="o">(</span><span class="n">solver</span><span class="o">.</span><span class="na">solve</span><span class="o">()){</span>
    <span class="c1">// do something on solution</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
<p>The objective variable and criteria should be declared,
but there is no need to post the cut manually, the solver manages this.
When the unfold search process is used, one can modify the way the cut is handled:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// Walking cut: allow same value solutions</span>
<span class="n">solver</span><span class="o">.</span><span class="na">getObjectiveManager</span><span class="o">().&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="n">setCutComputer</span><span class="o">(</span><span class="n">obj</span> <span class="o">-&gt;</span> <span class="n">obj</span><span class="o">);</span>
<span class="n">model</span><span class="o">.</span><span class="na">setObjective</span><span class="o">(</span><span class="n">ResolutionPolicy</span><span class="o">.</span><span class="na">MINIMIZE</span><span class="o">,</span> <span class="n">tot_cost</span><span class="o">);</span>
<span class="k">while</span><span class="o">(</span><span class="n">solver</span><span class="o">.</span><span class="na">solve</span><span class="o">()){</span>
    <span class="c1">// do something on solution</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Unfold search process allows you to execute code on solution easily.</p>
<p>One can add a limit to the resolution process.
For example, a 10 second-limit can be defined like this:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">solver</span><span class="o">.</span><span class="na">limitTime</span><span class="o">(</span><span class="s">&quot;10s&quot;</span><span class="o">);</span>
<span class="c1">// then run the resolution</span>
<span class="n">Solution</span> <span class="n">best</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="na">findOptimalSolution</span><span class="o">(</span><span class="n">tot_cost</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
</pre></div>
</td></tr></table></div>
<p>The search should be configured <strong>before</strong> being called.
There can be multiple limitations, in that case, the first reached stops the search.</p>
</div>
<div class="section" id="pretty-solution-output">
<h2>Pretty solution output<a class="headerlink" href="#pretty-solution-output" title="Permalink to this headline">¶</a></h2>
<p>We can define a function that prints any solutions in a pretty way.</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">private</span> <span class="kt">void</span> <span class="nf">prettyPrint</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">,</span> <span class="n">IntVar</span><span class="o">[]</span> <span class="n">open</span><span class="o">,</span> <span class="kt">int</span> <span class="n">W</span><span class="o">,</span> <span class="n">IntVar</span><span class="o">[]</span> <span class="n">supplier</span><span class="o">,</span> <span class="kt">int</span> <span class="n">S</span><span class="o">,</span> <span class="n">IntVar</span> <span class="n">tot_cost</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">StringBuilder</span> <span class="n">st</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
    <span class="n">st</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&quot;Solution #&quot;</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="n">model</span><span class="o">.</span><span class="na">getSolver</span><span class="o">().</span><span class="na">getSolutionCount</span><span class="o">()).</span><span class="na">append</span><span class="o">(</span><span class="s">&quot;\n&quot;</span><span class="o">);</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">W</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">open</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">getValue</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">st</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;\tWarehouse %d supplies customers : &quot;</span><span class="o">,</span> <span class="o">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)));</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">S</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">supplier</span><span class="o">[</span><span class="n">j</span><span class="o">].</span><span class="na">getValue</span><span class="o">()</span> <span class="o">==</span> <span class="o">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">))</span> <span class="o">{</span>
                    <span class="n">st</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;%d &quot;</span><span class="o">,</span> <span class="o">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)));</span>
                <span class="o">}</span>
            <span class="o">}</span>
            <span class="n">st</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&quot;\n&quot;</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="n">st</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&quot;\tTotal C: &quot;</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="n">tot_cost</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">st</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
<p>Calling this method is made easy with the unfold resolution instruction.</p>
</div>
<div class="section" id="the-entire-code">
<h2>The entire code<a class="headerlink" href="#the-entire-code" title="Permalink to this headline">¶</a></h2>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// load parameters</span>
<span class="c1">// number of warehouses</span>
<span class="kt">int</span> <span class="n">W</span> <span class="o">=</span> <span class="mi">5</span><span class="o">;</span>
<span class="c1">// number of stores</span>
<span class="kt">int</span> <span class="n">S</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span>
<span class="c1">// maintenance cost</span>
<span class="kt">int</span> <span class="n">C</span> <span class="o">=</span> <span class="mi">30</span><span class="o">;</span>
<span class="c1">// capacity of each warehouse</span>
<span class="kt">int</span><span class="o">[]</span> <span class="n">K</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[]{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">3</span><span class="o">};</span>
<span class="c1">// matrix of supply costs, store x warehouse</span>
<span class="kt">int</span><span class="o">[][]</span> <span class="n">P</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[][]{</span>
    <span class="o">{</span><span class="mi">20</span><span class="o">,</span> <span class="mi">24</span><span class="o">,</span> <span class="mi">11</span><span class="o">,</span> <span class="mi">25</span><span class="o">,</span> <span class="mi">30</span><span class="o">},</span>
    <span class="o">{</span><span class="mi">28</span><span class="o">,</span> <span class="mi">27</span><span class="o">,</span> <span class="mi">82</span><span class="o">,</span> <span class="mi">83</span><span class="o">,</span> <span class="mi">74</span><span class="o">},</span>
    <span class="o">{</span><span class="mi">74</span><span class="o">,</span> <span class="mi">97</span><span class="o">,</span> <span class="mi">71</span><span class="o">,</span> <span class="mi">96</span><span class="o">,</span> <span class="mi">70</span><span class="o">},</span>
    <span class="o">{</span><span class="mi">2</span><span class="o">,</span> <span class="mi">55</span><span class="o">,</span> <span class="mi">73</span><span class="o">,</span> <span class="mi">69</span><span class="o">,</span> <span class="mi">61</span><span class="o">},</span>
    <span class="o">{</span><span class="mi">46</span><span class="o">,</span> <span class="mi">96</span><span class="o">,</span> <span class="mi">59</span><span class="o">,</span> <span class="mi">83</span><span class="o">,</span> <span class="mi">4</span><span class="o">},</span>
    <span class="o">{</span><span class="mi">42</span><span class="o">,</span> <span class="mi">22</span><span class="o">,</span> <span class="mi">29</span><span class="o">,</span> <span class="mi">67</span><span class="o">,</span> <span class="mi">59</span><span class="o">},</span>
    <span class="o">{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">73</span><span class="o">,</span> <span class="mi">59</span><span class="o">,</span> <span class="mi">56</span><span class="o">},</span>
    <span class="o">{</span><span class="mi">10</span><span class="o">,</span> <span class="mi">73</span><span class="o">,</span> <span class="mi">13</span><span class="o">,</span> <span class="mi">43</span><span class="o">,</span> <span class="mi">96</span><span class="o">},</span>
    <span class="o">{</span><span class="mi">93</span><span class="o">,</span> <span class="mi">35</span><span class="o">,</span> <span class="mi">63</span><span class="o">,</span> <span class="mi">85</span><span class="o">,</span> <span class="mi">46</span><span class="o">},</span>
    <span class="o">{</span><span class="mi">47</span><span class="o">,</span> <span class="mi">65</span><span class="o">,</span> <span class="mi">55</span><span class="o">,</span> <span class="mi">71</span><span class="o">,</span> <span class="mi">95</span><span class="o">}};</span>

<span class="c1">// A new model instance</span>
<span class="n">Model</span> <span class="n">model</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Model</span><span class="o">(</span><span class="s">&quot;WarehouseLocation&quot;</span><span class="o">);</span>

<span class="c1">// VARIABLES</span>
<span class="c1">// a warehouse is either open or closed</span>
<span class="n">BoolVar</span><span class="o">[]</span> <span class="n">open</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">boolVarArray</span><span class="o">(</span><span class="s">&quot;o&quot;</span><span class="o">,</span> <span class="n">W</span><span class="o">);</span>
<span class="c1">// which warehouse supplies a store</span>
<span class="n">IntVar</span><span class="o">[]</span> <span class="n">supplier</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">intVarArray</span><span class="o">(</span><span class="s">&quot;supplier&quot;</span><span class="o">,</span> <span class="n">S</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="n">W</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
<span class="c1">// supplying cost per store</span>
<span class="n">IntVar</span><span class="o">[]</span> <span class="n">cost</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">intVarArray</span><span class="o">(</span><span class="s">&quot;cost&quot;</span><span class="o">,</span> <span class="n">S</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">96</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
<span class="c1">// Total of all costs</span>
<span class="n">IntVar</span> <span class="n">tot_cost</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">intVar</span><span class="o">(</span><span class="s">&quot;tot_cost&quot;</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">99999</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>

<span class="c1">// CONSTRAINTS</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">S</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
    <span class="c1">// a warehouse is &#39;open&#39;, if it supplies to a store</span>
    <span class="n">model</span><span class="o">.</span><span class="na">element</span><span class="o">(</span><span class="n">model</span><span class="o">.</span><span class="na">intVar</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span> <span class="n">open</span><span class="o">,</span> <span class="n">supplier</span><span class="o">[</span><span class="n">j</span><span class="o">],</span> <span class="mi">1</span><span class="o">).</span><span class="na">post</span><span class="o">();</span>
    <span class="c1">// Compute &#39;cost&#39; for each store</span>
    <span class="n">model</span><span class="o">.</span><span class="na">element</span><span class="o">(</span><span class="n">cost</span><span class="o">[</span><span class="n">j</span><span class="o">],</span> <span class="n">P</span><span class="o">[</span><span class="n">j</span><span class="o">],</span> <span class="n">supplier</span><span class="o">[</span><span class="n">j</span><span class="o">],</span> <span class="mi">1</span><span class="o">).</span><span class="na">post</span><span class="o">();</span>
<span class="o">}</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">W</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
    <span class="c1">// additional variable &#39;occ&#39; is created on the fly</span>
    <span class="c1">// its domain includes the constraint on capacity</span>
    <span class="n">IntVar</span> <span class="n">occ</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">intVar</span><span class="o">(</span><span class="s">&quot;occur_&quot;</span> <span class="o">+</span> <span class="n">i</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">K</span><span class="o">[</span><span class="n">i</span><span class="o">],</span> <span class="kc">true</span><span class="o">);</span>
    <span class="c1">// for-loop starts at 0, warehouse index starts at 1</span>
    <span class="c1">// =&gt; we count occurrences of (i+1) in &#39;supplier&#39;</span>
    <span class="n">model</span><span class="o">.</span><span class="na">count</span><span class="o">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="o">,</span> <span class="n">supplier</span><span class="o">,</span> <span class="n">occ</span><span class="o">).</span><span class="na">post</span><span class="o">();</span>
    <span class="c1">// redundant link between &#39;occ&#39; and &#39;open&#39; for better propagation</span>
    <span class="n">occ</span><span class="o">.</span><span class="na">ge</span><span class="o">(</span><span class="n">open</span><span class="o">[</span><span class="n">i</span><span class="o">]).</span><span class="na">post</span><span class="o">();</span>
<span class="o">}</span>
<span class="c1">// Prepare the constraint that maintains &#39;tot_cost&#39;</span>
<span class="kt">int</span><span class="o">[]</span> <span class="n">coeffs</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">W</span> <span class="o">+</span> <span class="n">S</span><span class="o">];</span>
<span class="n">Arrays</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">coeffs</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">W</span><span class="o">,</span> <span class="n">C</span><span class="o">);</span>
<span class="n">Arrays</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">coeffs</span><span class="o">,</span> <span class="n">W</span><span class="o">,</span> <span class="n">W</span> <span class="o">+</span> <span class="n">S</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
<span class="c1">// then post it</span>
<span class="n">model</span><span class="o">.</span><span class="na">scalar</span><span class="o">(</span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">open</span><span class="o">,</span> <span class="n">cost</span><span class="o">),</span> <span class="n">coeffs</span><span class="o">,</span> <span class="s">&quot;=&quot;</span><span class="o">,</span> <span class="n">tot_cost</span><span class="o">).</span><span class="na">post</span><span class="o">();</span>

<span class="n">model</span><span class="o">.</span><span class="na">setObjective</span><span class="o">(</span><span class="n">ResolutionPolicy</span><span class="o">.</span><span class="na">MINIMIZE</span><span class="o">,</span> <span class="n">tot_cost</span><span class="o">);</span>
<span class="n">Solver</span> <span class="n">solver</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">getSolver</span><span class="o">();</span>
<span class="n">solver</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">SearchStrategyFactory</span><span class="o">.</span><span class="na">intVarSearch</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">VariableSelectorWithTies</span><span class="o">&lt;&gt;(</span>
                <span class="k">new</span> <span class="n">FirstFail</span><span class="o">(</span><span class="n">model</span><span class="o">),</span>
                <span class="k">new</span> <span class="n">Smallest</span><span class="o">()),</span>
        <span class="n">ValSelectorFactory</span><span class="o">.</span><span class="na">midIntVal</span><span class="o">(</span><span class="kc">false</span><span class="o">),</span>
        <span class="n">ArrayUtils</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">supplier</span><span class="o">,</span> <span class="n">cost</span><span class="o">,</span> <span class="n">open</span><span class="o">))</span>
<span class="o">);</span>
<span class="n">solver</span><span class="o">.</span><span class="na">showShortStatistics</span><span class="o">();</span>
<span class="k">while</span><span class="o">(</span><span class="n">solver</span><span class="o">.</span><span class="na">solve</span><span class="o">()){</span>
    <span class="n">prettyPrint</span><span class="o">(</span><span class="n">model</span><span class="o">,</span> <span class="n">open</span><span class="o">,</span> <span class="n">W</span><span class="o">,</span> <span class="n">supplier</span><span class="o">,</span> <span class="n">S</span><span class="o">,</span> <span class="n">tot_cost</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
<p>The best solution found is:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Solution</span> <span class="c1">#23</span>
    <span class="n">Warehouse</span> <span class="mi">1</span> <span class="n">supplies</span> <span class="n">customers</span> <span class="p">:</span> <span class="mi">4</span>
    <span class="n">Warehouse</span> <span class="mi">2</span> <span class="n">supplies</span> <span class="n">customers</span> <span class="p">:</span> <span class="mi">2</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">9</span>
    <span class="n">Warehouse</span> <span class="mi">3</span> <span class="n">supplies</span> <span class="n">customers</span> <span class="p">:</span> <span class="mi">8</span> <span class="mi">10</span>
    <span class="n">Warehouse</span> <span class="mi">5</span> <span class="n">supplies</span> <span class="n">customers</span> <span class="p">:</span> <span class="mi">1</span> <span class="mi">3</span> <span class="mi">5</span>
    <span class="n">Total</span> <span class="n">C</span><span class="p">:</span> <span class="mi">383</span>
<span class="n">Model</span><span class="p">[</span><span class="n">Model</span><span class="o">-</span><span class="mi">0</span><span class="p">],</span> <span class="mi">23</span> <span class="n">Solutions</span><span class="p">,</span> <span class="n">Minimize</span> <span class="n">tot_cost</span> <span class="o">=</span> <span class="mi">383</span><span class="p">,</span> <span class="n">Resolution</span> <span class="n">time</span> <span class="mi">0</span><span class="p">,</span><span class="mi">069</span><span class="n">s</span><span class="p">,</span> <span class="mi">76</span> <span class="n">Nodes</span> <span class="p">(</span><span class="mi">1</span> <span class="mi">098</span><span class="p">,</span><span class="mi">9</span> <span class="n">n</span><span class="o">/</span><span class="n">s</span><span class="p">),</span> <span class="mi">93</span> <span class="n">Backtracks</span><span class="p">,</span> <span class="mi">26</span> <span class="n">Fails</span><span class="p">,</span> <span class="mi">0</span> <span class="n">Restarts</span>
</pre></div>
</div>
</div>
<div class="section" id="things-to-remember">
<h2>Things to remember<a class="headerlink" href="#things-to-remember" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>The <em>element</em> constraint can be very helpful, one can have more details on it on the <a class="reference external" href="http://sofdem.github.io/gccat/gccat/Celement.html">Global Constraint Catalog</a>.</li>
<li>The <em>count</em> constraint is also part of the must-have constraints (<a class="reference external" href="http://sofdem.github.io/gccat/gccat/Ccount.html">Global Constraint Catalog</a>).</li>
<li>Besides pre-defined search strategies, one can also constructed a specific one. Most of the time, it is worth the time spent on it.</li>
<li>The resolution process can be unfold and limited. It allows interacting with solution state without building default solution object.</li>
<li>Cut process is managed by the solver, but it can be modified when using the unfold resolution process.</li>
</ul>
<p><a class="reference external" href="402.mathmodel.html">&lt;&lt;mathematical model</a></p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">choco-tuto</a></h1>





<p>
<iframe src="https://ghbtns.com/github-btn.html?user=&repo=&type=watch&count=true&size=large"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>




<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="001.introduction.html">Introduction to choco-tuto</a></li>
<li class="toctree-l1"><a class="reference internal" href="002.history.html">Choco, a constraint programming java library</a></li>
<li class="toctree-l1"><a class="reference internal" href="003.installation.html">Installation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="201.firstexample.html">A first example</a></li>
<li class="toctree-l1"><a class="reference internal" href="202.objects.html">Objects in Choco</a></li>
<li class="toctree-l1"><a class="reference internal" href="203.firstexample2.html">Playing around with 8-queens puzzle</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="301.description.html">Verbal arithmetic</a></li>
<li class="toctree-l1"><a class="reference internal" href="401.description.html">Warehouse Location Problem</a></li>
<li class="toctree-l1"><a class="reference internal" href="501.description.html">Aircraft Landing Problem</a></li>
<li class="toctree-l1"><a class="reference internal" href="601.description.html">Nonogram</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Charles Prud'homme.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.7</a>
      
      |
      <a href="../_sources/src/403.code.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>