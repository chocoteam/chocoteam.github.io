<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Code &mdash; choco-tuto 1.0.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="choco-tuto 1.0.0 documentation" href="../index.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="code">
<span id="al-code"></span><h1>Code<a class="headerlink" href="#code" title="Permalink to this headline">¶</a></h1>
<div class="section" id="a-model">
<h2>A model<a class="headerlink" href="#a-model" title="Permalink to this headline">¶</a></h2>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// load parameters</span>
<span class="c1">// ...</span>
<span class="c1">// A new model instance</span>
<span class="n">Model</span> <span class="n">model</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Model</span><span class="o">(</span><span class="s">&quot;Aircraft landing&quot;</span><span class="o">);</span>
<span class="c1">// Variables declaration</span>
<span class="n">IntVar</span><span class="o">[]</span> <span class="n">planes</span> <span class="o">=</span> <span class="n">IntStream</span>
        <span class="o">.</span><span class="na">range</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">N</span><span class="o">)</span>
        <span class="o">.</span><span class="na">mapToObj</span><span class="o">(</span><span class="n">i</span> <span class="o">-&gt;</span> <span class="n">model</span><span class="o">.</span><span class="na">intVar</span><span class="o">(</span><span class="s">&quot;plane #&quot;</span> <span class="o">+</span> <span class="n">i</span><span class="o">,</span> <span class="n">LT</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="mi">0</span><span class="o">],</span> <span class="n">LT</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="mi">2</span><span class="o">],</span> <span class="kc">false</span><span class="o">))</span>
        <span class="o">.</span><span class="na">toArray</span><span class="o">(</span><span class="n">IntVar</span><span class="o">[]::</span><span class="k">new</span><span class="o">);</span>
<span class="n">IntVar</span><span class="o">[]</span> <span class="n">earliness</span> <span class="o">=</span> <span class="n">IntStream</span>
        <span class="o">.</span><span class="na">range</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">N</span><span class="o">)</span>
        <span class="o">.</span><span class="na">mapToObj</span><span class="o">(</span><span class="n">i</span> <span class="o">-&gt;</span> <span class="n">model</span><span class="o">.</span><span class="na">intVar</span><span class="o">(</span><span class="s">&quot;earliness #&quot;</span> <span class="o">+</span> <span class="n">i</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">LT</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="mi">1</span><span class="o">]</span> <span class="o">-</span> <span class="n">LT</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="mi">0</span><span class="o">],</span> <span class="kc">false</span><span class="o">))</span>
        <span class="o">.</span><span class="na">toArray</span><span class="o">(</span><span class="n">IntVar</span><span class="o">[]::</span><span class="k">new</span><span class="o">);</span>
<span class="n">IntVar</span><span class="o">[]</span> <span class="n">tardiness</span> <span class="o">=</span> <span class="n">IntStream</span>
        <span class="o">.</span><span class="na">range</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">N</span><span class="o">)</span>
        <span class="o">.</span><span class="na">mapToObj</span><span class="o">(</span><span class="n">i</span> <span class="o">-&gt;</span> <span class="n">model</span><span class="o">.</span><span class="na">intVar</span><span class="o">(</span><span class="s">&quot;tardiness #&quot;</span> <span class="o">+</span> <span class="n">i</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">LT</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="mi">2</span><span class="o">]</span> <span class="o">-</span> <span class="n">LT</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="mi">1</span><span class="o">],</span> <span class="kc">false</span><span class="o">))</span>
        <span class="o">.</span><span class="na">toArray</span><span class="o">(</span><span class="n">IntVar</span><span class="o">[]::</span><span class="k">new</span><span class="o">);</span>

<span class="n">IntVar</span> <span class="n">tot_dev</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">intVar</span><span class="o">(</span><span class="s">&quot;tot_dev&quot;</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">IntVar</span><span class="o">.</span><span class="na">MAX_INT_BOUND</span><span class="o">);</span>

<span class="c1">// Constraint posting</span>
<span class="c1">// one plane per runway at a time:</span>
<span class="n">model</span><span class="o">.</span><span class="na">allDifferent</span><span class="o">(</span><span class="n">planes</span><span class="o">).</span><span class="na">post</span><span class="o">();</span>
<span class="c1">// for each plane &#39;i&#39;</span>
<span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
    <span class="c1">// maintain earliness</span>
    <span class="n">earliness</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">eq</span><span class="o">((</span><span class="n">planes</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">neg</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">LT</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="mi">1</span><span class="o">])).</span><span class="na">max</span><span class="o">(</span><span class="mi">0</span><span class="o">)).</span><span class="na">post</span><span class="o">();</span>
    <span class="c1">// and tardiness</span>
    <span class="n">tardiness</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">eq</span><span class="o">((</span><span class="n">planes</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">sub</span><span class="o">(</span><span class="n">LT</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="mi">1</span><span class="o">])).</span><span class="na">max</span><span class="o">(</span><span class="mi">0</span><span class="o">)).</span><span class="na">post</span><span class="o">();</span>
    <span class="c1">// disjunctions: &#39;i&#39; lands before &#39;j&#39; or &#39;j&#39; lands before &#39;i&#39;</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">N</span><span class="o">;</span> <span class="n">j</span><span class="o">++){</span>
        <span class="n">Constraint</span> <span class="n">iBeforej</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">arithm</span><span class="o">(</span><span class="n">planes</span><span class="o">[</span><span class="n">i</span><span class="o">],</span> <span class="s">&quot;&lt;=&quot;</span><span class="o">,</span> <span class="n">planes</span><span class="o">[</span><span class="n">j</span><span class="o">],</span> <span class="s">&quot;-&quot;</span><span class="o">,</span> <span class="n">ST</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span><span class="o">]);</span>
        <span class="n">Constraint</span> <span class="n">jBeforei</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">arithm</span><span class="o">(</span><span class="n">planes</span><span class="o">[</span><span class="n">j</span><span class="o">],</span> <span class="s">&quot;&lt;=&quot;</span><span class="o">,</span> <span class="n">planes</span><span class="o">[</span><span class="n">i</span><span class="o">],</span> <span class="s">&quot;-&quot;</span><span class="o">,</span> <span class="n">ST</span><span class="o">[</span><span class="n">j</span><span class="o">][</span><span class="n">i</span><span class="o">]);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addClausesBoolNot</span><span class="o">(</span><span class="n">iBeforej</span><span class="o">.</span><span class="na">reify</span><span class="o">(),</span> <span class="n">jBeforei</span><span class="o">.</span><span class="na">reify</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="c1">// prepare coefficients of the scalar product</span>
<span class="kt">int</span><span class="o">[]</span> <span class="n">cs</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">N</span><span class="o">*</span><span class="mi">2</span><span class="o">];</span>
<span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
    <span class="n">cs</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">PC</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="mi">0</span><span class="o">];</span>
    <span class="n">cs</span><span class="o">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">N</span><span class="o">]</span> <span class="o">=</span> <span class="n">PC</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="mi">1</span><span class="o">];</span>
<span class="o">}</span>
<span class="n">model</span><span class="o">.</span><span class="na">scalar</span><span class="o">(</span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">earliness</span><span class="o">,</span> <span class="n">tardiness</span><span class="o">),</span> <span class="n">cs</span><span class="o">,</span> <span class="s">&quot;=&quot;</span><span class="o">,</span> <span class="n">tot_dev</span><span class="o">).</span><span class="na">post</span><span class="o">();</span>
</pre></div>
</td></tr></table></div>
<p>Note that all variables could be bounded, since no constraint makes holes in the domain.
However, turning them into enumerated ones will be required to design an efficient search strategy.</p>
<p>The objective variable, &#8216;tot_dev&#8217; is declared with an arbitrary large upper bound.
Instead of using <cite>Integer.MAX_VALUE</cite>, we call <cite>IntVar.MAX_INT_BOUND</cite> a pre-defined parameter
not too big to limit overflow. A better solution would be to compute the real bounds of the variable, based on <cite>LT</cite> and <cite>PC</cite>.
In our case <span class="math">\([\![0,117790]\!]\)</span> is the smallest interval that eliminates no solution.</p>
<p>The <em>alldifferent</em> constraint (line 23) is redundant with disjunction constraints (lines 31-35).
But it provides stronger filtering.</p>
<p>The declaration of the disjunction (line 34) does not require to post the constraint.
Calling method like &#8216;addClause*&#8217; add clauses to a specific clause store which acts as specific singleton constraint.
The code can however replaced by :</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="na">or</span><span class="o">(</span><span class="n">iBeforej</span><span class="o">,</span><span class="n">jBeforei</span><span class="o">).</span><span class="na">post</span><span class="o">();</span>
</pre></div>
</div>
<p>In that case, the logical expression will be transformed into a sum constraint.
Yet, <span class="math">\(\frac{N \times (N-1}{2}\)</span> constraints will be added to the solver.</p>
</div>
<div class="section" id="a-search-strategy">
<h2>A search strategy<a class="headerlink" href="#a-search-strategy" title="Permalink to this headline">¶</a></h2>
<p>Intuitively, a good strategy to solve the problem is to select first the variable
whom distance to the target landing time and the closest possible landing time is the biggest.
It tends to avoid letting a plane with already late (resp. early) being even more late (resp. early).</p>
<p>Then, for a given plane, we want to minimize the distance to the target landing time.
So we simply choose the value in its domain closest to the target landing time.</p>
<p>First, we map each plane with its target landing time:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">Map</span><span class="o">&lt;</span><span class="n">IntVar</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span>
    <span class="n">IntStream</span><span class="o">.</span><span class="na">range</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">N</span><span class="o">)</span>
             <span class="o">.</span><span class="na">boxed</span><span class="o">()</span>
             <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toMap</span><span class="o">(</span><span class="n">i</span> <span class="o">-&gt;</span> <span class="n">planes</span><span class="o">[</span><span class="n">i</span><span class="o">],</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="n">LT</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="mi">1</span><span class="o">]));</span>
</pre></div>
</td></tr></table></div>
<p>Then, for a given plane, a function is created to look for the possible landing time closest to the target landing time:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">closest</span><span class="o">(</span><span class="n">IntVar</span> <span class="n">var</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">IntVar</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">target</span> <span class="o">=</span> <span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">var</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">var</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">target</span><span class="o">))</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">target</span><span class="o">;</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">p</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="na">previousValue</span><span class="o">(</span><span class="n">target</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="na">nextValue</span><span class="o">(</span><span class="n">target</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">target</span> <span class="o">-</span> <span class="n">p</span><span class="o">)</span> <span class="o">&lt;</span> <span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">target</span><span class="o">)</span> <span class="o">?</span> <span class="n">p</span> <span class="o">:</span> <span class="n">n</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
<p>Note that, <cite>var.previousValue(target)</cite> can return <cite>Integer.MIN_VALUE</cite> which indicates that there is no value
before <cite>target</cite> in the domain of var (same goes with <cite>var.nextValue(target)</cite> and <cite>Integer.MAX_VALUE</cite>).
That&#8217;s why the absolute difference is computed, and the minimum is returned.</p>
<p>Finally, the search strategy is defined:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">solver</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">SearchStrategyFactory</span><span class="o">.</span><span class="na">intVarSearch</span><span class="o">(</span>
    <span class="n">variables</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="n">Optional</span><span class="o">&lt;</span><span class="n">IntVar</span><span class="o">&gt;</span> <span class="n">selected</span> <span class="o">=</span>
                <span class="n">Arrays</span><span class="o">.</span><span class="na">stream</span><span class="o">(</span><span class="n">variables</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">v</span> <span class="o">-&gt;</span> <span class="o">!</span><span class="n">v</span><span class="o">.</span><span class="na">isInstantiated</span><span class="o">())</span>
                        <span class="o">.</span><span class="na">min</span><span class="o">((</span><span class="n">v1</span><span class="o">,</span> <span class="n">v2</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">closest</span><span class="o">(</span><span class="n">v2</span><span class="o">,</span> <span class="n">map</span><span class="o">)</span> <span class="o">-</span> <span class="n">closest</span><span class="o">(</span><span class="n">v1</span><span class="o">,</span> <span class="n">map</span><span class="o">))</span>
                        <span class="o">.</span><span class="na">orElse</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
    <span class="o">},</span>
    <span class="n">var</span> <span class="o">-&gt;</span> <span class="n">closest</span><span class="o">(</span><span class="n">var</span><span class="o">,</span> <span class="n">map</span><span class="o">),</span>
    <span class="n">DecisionOperator</span><span class="o">.</span><span class="na">int_eq</span><span class="o">,</span>
    <span class="n">planes</span>
<span class="o">));</span>
</pre></div>
</td></tr></table></div>
<p>Lines 2-7: non-instantiated variables are filtered and the more distant to the target landing time is returned.
Note that if all variables are instantiated, null is expected to indicate that the strategy runs dry.
Line 8: the closest possible landing time for a given variable is returned.
Line 9: the decision is based on the assignment operator.
Left decision branch is assignment, right decision branch (refutation) is value removal. That is why the domain of planes
must be enumerated.
Line 10: the scope variables is defined.</p>
<p>The three instructions (Lines2-10) are input in <cite>SearchStrategyFactory.intVarSearch</cite> which builds in return a integer
variable search strategy.</p>
</div>
<div class="section" id="the-resolution-objective">
<h2>The resolution objective<a class="headerlink" href="#the-resolution-objective" title="Permalink to this headline">¶</a></h2>
<p>The objective is to minimize &#8216;tot_dev&#8217;.</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// Find a solution that minimizes &#39;tot_dev&#39;</span>
<span class="n">Solution</span> <span class="n">best</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="na">findOptimalSolution</span><span class="o">(</span><span class="n">tot_dev</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
</pre></div>
</td></tr></table></div>
<p>This method attempts to find the optimal solution.</p>
<p>If one wants to interact with each solution without using the unfold resolution process, she/he can plug a solution monitor
to the solver.
Such monitor implements an one-method interface called on each solution:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">solver</span><span class="o">.</span><span class="na">plugMonitor</span><span class="o">((</span><span class="n">IMonitorSolution</span><span class="o">)</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&quot;%s lands at %d (%d)\n&quot;</span><span class="o">,</span>
                <span class="n">planes</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">getName</span><span class="o">(),</span>
                <span class="n">planes</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">getValue</span><span class="o">(),</span>
                <span class="n">planes</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">getValue</span><span class="o">()</span> <span class="o">-</span> <span class="n">LT</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="mi">1</span><span class="o">]);</span>
    <span class="o">}</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&quot;Deviation cost: %d\n&quot;</span><span class="o">,</span> <span class="n">tot_dev</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
<span class="o">});</span>
</pre></div>
</td></tr></table></div>
<p>We print here the real landing time and the distance to the target landing time for each plane and the total deviation
cost.</p>
</div>
<div class="section" id="the-entire-code">
<h2>The entire code<a class="headerlink" href="#the-entire-code" title="Permalink to this headline">¶</a></h2>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// number of planes</span>
<span class="kt">int</span> <span class="n">N</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span>
<span class="c1">// Times per plane:</span>
<span class="c1">// {earliest landing time, target landing time, latest landing time}</span>
<span class="kt">int</span><span class="o">[][]</span> <span class="n">LT</span> <span class="o">=</span> <span class="o">{</span>
        <span class="o">{</span><span class="mi">129</span><span class="o">,</span> <span class="mi">155</span><span class="o">,</span> <span class="mi">559</span><span class="o">},</span>
        <span class="o">{</span><span class="mi">195</span><span class="o">,</span> <span class="mi">258</span><span class="o">,</span> <span class="mi">744</span><span class="o">},</span>
        <span class="o">{</span><span class="mi">89</span><span class="o">,</span> <span class="mi">98</span><span class="o">,</span> <span class="mi">510</span><span class="o">},</span>
        <span class="o">{</span><span class="mi">96</span><span class="o">,</span> <span class="mi">106</span><span class="o">,</span> <span class="mi">521</span><span class="o">},</span>
        <span class="o">{</span><span class="mi">110</span><span class="o">,</span> <span class="mi">123</span><span class="o">,</span> <span class="mi">555</span><span class="o">},</span>
        <span class="o">{</span><span class="mi">120</span><span class="o">,</span> <span class="mi">135</span><span class="o">,</span> <span class="mi">576</span><span class="o">},</span>
        <span class="o">{</span><span class="mi">124</span><span class="o">,</span> <span class="mi">138</span><span class="o">,</span> <span class="mi">577</span><span class="o">},</span>
        <span class="o">{</span><span class="mi">126</span><span class="o">,</span> <span class="mi">140</span><span class="o">,</span> <span class="mi">573</span><span class="o">},</span>
        <span class="o">{</span><span class="mi">135</span><span class="o">,</span> <span class="mi">150</span><span class="o">,</span> <span class="mi">591</span><span class="o">},</span>
        <span class="o">{</span><span class="mi">160</span><span class="o">,</span> <span class="mi">180</span><span class="o">,</span> <span class="mi">657</span><span class="o">}};</span>
<span class="c1">// penalty cost penalty cost per unit of time per plane:</span>
<span class="c1">// {for landing before target, after target}</span>
<span class="kt">int</span><span class="o">[][]</span> <span class="n">PC</span> <span class="o">=</span> <span class="o">{</span>
        <span class="o">{</span><span class="mi">10</span><span class="o">,</span> <span class="mi">10</span><span class="o">},</span>
        <span class="o">{</span><span class="mi">10</span><span class="o">,</span> <span class="mi">10</span><span class="o">},</span>
        <span class="o">{</span><span class="mi">30</span><span class="o">,</span> <span class="mi">30</span><span class="o">},</span>
        <span class="o">{</span><span class="mi">30</span><span class="o">,</span> <span class="mi">30</span><span class="o">},</span>
        <span class="o">{</span><span class="mi">30</span><span class="o">,</span> <span class="mi">30</span><span class="o">},</span>
        <span class="o">{</span><span class="mi">30</span><span class="o">,</span> <span class="mi">30</span><span class="o">},</span>
        <span class="o">{</span><span class="mi">30</span><span class="o">,</span> <span class="mi">30</span><span class="o">},</span>
        <span class="o">{</span><span class="mi">30</span><span class="o">,</span> <span class="mi">30</span><span class="o">},</span>
        <span class="o">{</span><span class="mi">30</span><span class="o">,</span> <span class="mi">30</span><span class="o">},</span>
        <span class="o">{</span><span class="mi">30</span><span class="o">,</span> <span class="mi">30</span><span class="o">}};</span>
<span class="c1">// Separation time required after i lands before j can land</span>
<span class="kt">int</span><span class="o">[][]</span> <span class="n">ST</span> <span class="o">=</span> <span class="o">{</span>
        <span class="o">{</span><span class="mi">99999</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">15</span><span class="o">,</span> <span class="mi">15</span><span class="o">,</span> <span class="mi">15</span><span class="o">,</span> <span class="mi">15</span><span class="o">,</span> <span class="mi">15</span><span class="o">,</span> <span class="mi">15</span><span class="o">,</span> <span class="mi">15</span><span class="o">,</span> <span class="mi">15</span><span class="o">},</span>
        <span class="o">{</span><span class="mi">3</span><span class="o">,</span> <span class="mi">99999</span><span class="o">,</span> <span class="mi">15</span><span class="o">,</span> <span class="mi">15</span><span class="o">,</span> <span class="mi">15</span><span class="o">,</span> <span class="mi">15</span><span class="o">,</span> <span class="mi">15</span><span class="o">,</span> <span class="mi">15</span><span class="o">,</span> <span class="mi">15</span><span class="o">,</span> <span class="mi">15</span><span class="o">},</span>
        <span class="o">{</span><span class="mi">15</span><span class="o">,</span> <span class="mi">15</span><span class="o">,</span> <span class="mi">99999</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">},</span>
        <span class="o">{</span><span class="mi">15</span><span class="o">,</span> <span class="mi">15</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">99999</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">},</span>
        <span class="o">{</span><span class="mi">15</span><span class="o">,</span> <span class="mi">15</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">99999</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">},</span>
        <span class="o">{</span><span class="mi">15</span><span class="o">,</span> <span class="mi">15</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">99999</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">},</span>
        <span class="o">{</span><span class="mi">15</span><span class="o">,</span> <span class="mi">15</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">99999</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">},</span>
        <span class="o">{</span><span class="mi">15</span><span class="o">,</span> <span class="mi">15</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">999999</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">},</span>
        <span class="o">{</span><span class="mi">15</span><span class="o">,</span> <span class="mi">15</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">99999</span><span class="o">,</span> <span class="mi">8</span><span class="o">},</span>
        <span class="o">{</span><span class="mi">15</span><span class="o">,</span> <span class="mi">15</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">99999</span><span class="o">}};</span>

<span class="n">Model</span> <span class="n">model</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Model</span><span class="o">(</span><span class="s">&quot;Aircraft landing&quot;</span><span class="o">);</span>
<span class="c1">// Variables declaration</span>
<span class="n">IntVar</span><span class="o">[]</span> <span class="n">planes</span> <span class="o">=</span> <span class="n">IntStream</span>
        <span class="o">.</span><span class="na">range</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">N</span><span class="o">)</span>
        <span class="o">.</span><span class="na">mapToObj</span><span class="o">(</span><span class="n">i</span> <span class="o">-&gt;</span> <span class="n">model</span><span class="o">.</span><span class="na">intVar</span><span class="o">(</span><span class="s">&quot;plane #&quot;</span> <span class="o">+</span> <span class="n">i</span><span class="o">,</span> <span class="n">LT</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="mi">0</span><span class="o">],</span> <span class="n">LT</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="mi">2</span><span class="o">],</span> <span class="kc">false</span><span class="o">))</span>
        <span class="o">.</span><span class="na">toArray</span><span class="o">(</span><span class="n">IntVar</span><span class="o">[]::</span><span class="k">new</span><span class="o">);</span>
<span class="n">IntVar</span><span class="o">[]</span> <span class="n">earliness</span> <span class="o">=</span> <span class="n">IntStream</span>
        <span class="o">.</span><span class="na">range</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">N</span><span class="o">)</span>
        <span class="o">.</span><span class="na">mapToObj</span><span class="o">(</span><span class="n">i</span> <span class="o">-&gt;</span> <span class="n">model</span><span class="o">.</span><span class="na">intVar</span><span class="o">(</span><span class="s">&quot;earliness #&quot;</span> <span class="o">+</span> <span class="n">i</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">LT</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="mi">1</span><span class="o">]</span> <span class="o">-</span> <span class="n">LT</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="mi">0</span><span class="o">],</span> <span class="kc">false</span><span class="o">))</span>
        <span class="o">.</span><span class="na">toArray</span><span class="o">(</span><span class="n">IntVar</span><span class="o">[]::</span><span class="k">new</span><span class="o">);</span>
<span class="n">IntVar</span><span class="o">[]</span> <span class="n">tardiness</span> <span class="o">=</span> <span class="n">IntStream</span>
        <span class="o">.</span><span class="na">range</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">N</span><span class="o">)</span>
        <span class="o">.</span><span class="na">mapToObj</span><span class="o">(</span><span class="n">i</span> <span class="o">-&gt;</span> <span class="n">model</span><span class="o">.</span><span class="na">intVar</span><span class="o">(</span><span class="s">&quot;tardiness #&quot;</span> <span class="o">+</span> <span class="n">i</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">LT</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="mi">2</span><span class="o">]</span> <span class="o">-</span> <span class="n">LT</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="mi">1</span><span class="o">],</span> <span class="kc">false</span><span class="o">))</span>
        <span class="o">.</span><span class="na">toArray</span><span class="o">(</span><span class="n">IntVar</span><span class="o">[]::</span><span class="k">new</span><span class="o">);</span>
<span class="n">IntVar</span> <span class="n">tot_dev</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">intVar</span><span class="o">(</span><span class="s">&quot;tot_dev&quot;</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">IntVar</span><span class="o">.</span><span class="na">MAX_INT_BOUND</span><span class="o">);</span>
<span class="c1">// Constraint posting</span>
<span class="c1">// one plane per runway at a time:</span>
<span class="n">model</span><span class="o">.</span><span class="na">allDifferent</span><span class="o">(</span><span class="n">planes</span><span class="o">).</span><span class="na">post</span><span class="o">();</span>
<span class="c1">// for each plane &#39;i&#39;</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
    <span class="c1">// maintain earliness</span>
    <span class="n">earliness</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">eq</span><span class="o">((</span><span class="n">planes</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">neg</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">LT</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="mi">1</span><span class="o">])).</span><span class="na">max</span><span class="o">(</span><span class="mi">0</span><span class="o">)).</span><span class="na">post</span><span class="o">();</span>
    <span class="c1">// and tardiness</span>
    <span class="n">tardiness</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">eq</span><span class="o">((</span><span class="n">planes</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">sub</span><span class="o">(</span><span class="n">LT</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="mi">1</span><span class="o">])).</span><span class="na">max</span><span class="o">(</span><span class="mi">0</span><span class="o">)).</span><span class="na">post</span><span class="o">();</span>
    <span class="c1">// disjunctions: &#39;i&#39; lands before &#39;j&#39; or &#39;j&#39; lands before &#39;i&#39;</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">N</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
        <span class="n">Constraint</span> <span class="n">iBeforej</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">arithm</span><span class="o">(</span><span class="n">planes</span><span class="o">[</span><span class="n">i</span><span class="o">],</span> <span class="s">&quot;&lt;=&quot;</span><span class="o">,</span> <span class="n">planes</span><span class="o">[</span><span class="n">j</span><span class="o">],</span> <span class="s">&quot;-&quot;</span><span class="o">,</span> <span class="n">ST</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span><span class="o">]);</span>
        <span class="n">Constraint</span> <span class="n">jBeforei</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">arithm</span><span class="o">(</span><span class="n">planes</span><span class="o">[</span><span class="n">j</span><span class="o">],</span> <span class="s">&quot;&lt;=&quot;</span><span class="o">,</span> <span class="n">planes</span><span class="o">[</span><span class="n">i</span><span class="o">],</span> <span class="s">&quot;-&quot;</span><span class="o">,</span> <span class="n">ST</span><span class="o">[</span><span class="n">j</span><span class="o">][</span><span class="n">i</span><span class="o">]);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addClausesBoolNot</span><span class="o">(</span><span class="n">iBeforej</span><span class="o">.</span><span class="na">reify</span><span class="o">(),</span> <span class="n">jBeforei</span><span class="o">.</span><span class="na">reify</span><span class="o">());</span> <span class="c1">// no need to post</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="c1">// prepare coefficients of the scalar product</span>
<span class="kt">int</span><span class="o">[]</span> <span class="n">cs</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">N</span> <span class="o">*</span> <span class="mi">2</span><span class="o">];</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
    <span class="n">cs</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">PC</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="mi">0</span><span class="o">];</span>
    <span class="n">cs</span><span class="o">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">N</span><span class="o">]</span> <span class="o">=</span> <span class="n">PC</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="mi">1</span><span class="o">];</span>
<span class="o">}</span>
<span class="n">model</span><span class="o">.</span><span class="na">scalar</span><span class="o">(</span><span class="n">ArrayUtils</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">earliness</span><span class="o">,</span> <span class="n">tardiness</span><span class="o">),</span> <span class="n">cs</span><span class="o">,</span> <span class="s">&quot;=&quot;</span><span class="o">,</span> <span class="n">tot_dev</span><span class="o">).</span><span class="na">post</span><span class="o">();</span>
<span class="c1">// Resolution process</span>
<span class="n">Solver</span> <span class="n">solver</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">getSolver</span><span class="o">();</span>
<span class="n">solver</span><span class="o">.</span><span class="na">plugMonitor</span><span class="o">((</span><span class="n">IMonitorSolution</span><span class="o">)</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&quot;%s lands at %d (%d)\n&quot;</span><span class="o">,</span>
                <span class="n">planes</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">getName</span><span class="o">(),</span>
                <span class="n">planes</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">getValue</span><span class="o">(),</span>
                <span class="n">planes</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">getValue</span><span class="o">()</span> <span class="o">-</span> <span class="n">LT</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="mi">1</span><span class="o">]);</span>
    <span class="o">}</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&quot;Deviation cost: %d\n&quot;</span><span class="o">,</span> <span class="n">tot_dev</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
<span class="o">});</span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">IntVar</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="n">IntStream</span>
        <span class="o">.</span><span class="na">range</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">N</span><span class="o">)</span>
        <span class="o">.</span><span class="na">boxed</span><span class="o">()</span>
        <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toMap</span><span class="o">(</span><span class="n">i</span> <span class="o">-&gt;</span> <span class="n">planes</span><span class="o">[</span><span class="n">i</span><span class="o">],</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="n">LT</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="mi">1</span><span class="o">]));</span>
<span class="n">solver</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">SearchStrategyFactory</span><span class="o">.</span><span class="na">intVarSearch</span><span class="o">(</span>
        <span class="n">variables</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="n">Optional</span><span class="o">&lt;</span><span class="n">IntVar</span><span class="o">&gt;</span> <span class="n">selected</span> <span class="o">=</span>
                    <span class="n">Arrays</span><span class="o">.</span><span class="na">stream</span><span class="o">(</span><span class="n">variables</span><span class="o">)</span>
                            <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">v</span> <span class="o">-&gt;</span> <span class="o">!</span><span class="n">v</span><span class="o">.</span><span class="na">isInstantiated</span><span class="o">())</span>
                            <span class="o">.</span><span class="na">min</span><span class="o">((</span><span class="n">v1</span><span class="o">,</span> <span class="n">v2</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">closest</span><span class="o">(</span><span class="n">v2</span><span class="o">,</span> <span class="n">map</span><span class="o">)</span> <span class="o">-</span> <span class="n">closest</span><span class="o">(</span><span class="n">v1</span><span class="o">,</span> <span class="n">map</span><span class="o">))</span>
                            <span class="o">.</span><span class="na">orElse</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
        <span class="o">},</span>
        <span class="n">var</span> <span class="o">-&gt;</span> <span class="n">closest</span><span class="o">(</span><span class="n">var</span><span class="o">,</span> <span class="n">map</span><span class="o">),</span>
        <span class="n">DecisionOperator</span><span class="o">.</span><span class="na">int_eq</span><span class="o">,</span>
        <span class="n">planes</span>
<span class="o">));</span>
<span class="n">solver</span><span class="o">.</span><span class="na">showShortStatistics</span><span class="o">();</span>
<span class="n">solver</span><span class="o">.</span><span class="na">findOptimalSolution</span><span class="o">(</span><span class="n">tot_dev</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
</pre></div>
</td></tr></table></div>
<p>The best solution found is:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">plane</span> <span class="c1">#0 lands at 165 (10)</span>
<span class="n">plane</span> <span class="c1">#1 lands at 258 (0)</span>
<span class="n">plane</span> <span class="c1">#2 lands at 98 (0)</span>
<span class="n">plane</span> <span class="c1">#3 lands at 106 (0)</span>
<span class="n">plane</span> <span class="c1">#4 lands at 118 (-5)</span>
<span class="n">plane</span> <span class="c1">#5 lands at 134 (-1)</span>
<span class="n">plane</span> <span class="c1">#6 lands at 126 (-12)</span>
<span class="n">plane</span> <span class="c1">#7 lands at 142 (2)</span>
<span class="n">plane</span> <span class="c1">#8 lands at 150 (0)</span>
<span class="n">plane</span> <span class="c1">#9 lands at 180 (0)</span>
<span class="n">Deviation</span> <span class="n">cost</span><span class="p">:</span> <span class="mi">700</span>
<span class="n">Model</span><span class="p">[</span><span class="n">Aircraft</span> <span class="n">landing</span><span class="p">],</span> <span class="mi">7</span> <span class="n">Solutions</span><span class="p">,</span> <span class="n">Minimize</span> <span class="n">tot_dev</span> <span class="o">=</span> <span class="mi">700</span><span class="p">,</span> <span class="n">Resolution</span> <span class="n">time</span> <span class="mi">0</span><span class="p">,</span><span class="mi">326</span><span class="n">s</span><span class="p">,</span> <span class="mi">906</span> <span class="n">Nodes</span> <span class="p">(</span><span class="mi">2</span> <span class="mi">781</span><span class="p">,</span><span class="mi">1</span> <span class="n">n</span><span class="o">/</span><span class="n">s</span><span class="p">),</span> <span class="mi">1756</span> <span class="n">Backtracks</span><span class="p">,</span> <span class="mi">883</span> <span class="n">Fails</span><span class="p">,</span> <span class="mi">0</span> <span class="n">Restarts</span>
<span class="n">Model</span><span class="p">[</span><span class="n">Aircraft</span> <span class="n">landing</span><span class="p">],</span> <span class="mi">7</span> <span class="n">Solutions</span><span class="p">,</span> <span class="n">Minimize</span> <span class="n">tot_dev</span> <span class="o">=</span> <span class="mi">700</span><span class="p">,</span> <span class="n">Resolution</span> <span class="n">time</span> <span class="mi">12</span><span class="p">,</span><span class="mi">608</span><span class="n">s</span><span class="p">,</span> <span class="mi">246096</span> <span class="n">Nodes</span> <span class="p">(</span><span class="mi">19</span> <span class="mi">519</span><span class="p">,</span><span class="mi">6</span> <span class="n">n</span><span class="o">/</span><span class="n">s</span><span class="p">),</span> <span class="mi">492179</span> <span class="n">Backtracks</span><span class="p">,</span> <span class="mi">246083</span> <span class="n">Fails</span><span class="p">,</span> <span class="mi">0</span> <span class="n">Restarts</span>
</pre></div>
</div>
<p>The second to last line of the console sums up the resolution statistics when the last solution was found :</p>
<ul class="simple">
<li>this is the twelfth solution, its cost is 700 (&#8216;tot_dev&#8217;), it took 326ms and 906 nodes were opened to find it.</li>
</ul>
<p>The last line of the console sums up to resolution statistics of the entire resolution, including optimality proof:</p>
<ul class="simple">
<li>7 solutions were found, 12,608s seconds and 246096 nodes were needed to explore the entire search space and prove the</li>
</ul>
<p>optimality of the last solution found.</p>
<p>If the plane selection is turned upside down (less late (early) plane is selected first)
the resolution statistics change a bit:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">Model</span><span class="p">[</span><span class="n">Aircraft</span> <span class="n">landing</span><span class="p">],</span> <span class="mi">12</span> <span class="n">Solutions</span><span class="p">,</span> <span class="n">Minimize</span> <span class="n">tot_dev</span> <span class="o">=</span> <span class="mi">700</span><span class="p">,</span> <span class="n">Resolution</span> <span class="n">time</span> <span class="mi">0</span><span class="p">,</span><span class="mi">514</span><span class="n">s</span><span class="p">,</span> <span class="mi">2147</span> <span class="n">Nodes</span> <span class="p">(</span><span class="mi">4</span> <span class="mi">180</span><span class="p">,</span><span class="mi">8</span> <span class="n">n</span><span class="o">/</span><span class="n">s</span><span class="p">),</span> <span class="mi">4222</span> <span class="n">Backtracks</span><span class="p">,</span> <span class="mi">2119</span> <span class="n">Fails</span><span class="p">,</span> <span class="mi">0</span> <span class="n">Restarts</span>
<span class="n">Model</span><span class="p">[</span><span class="n">Aircraft</span> <span class="n">landing</span><span class="p">],</span> <span class="mi">12</span> <span class="n">Solutions</span><span class="p">,</span> <span class="n">Minimize</span> <span class="n">tot_dev</span> <span class="o">=</span> <span class="mi">700</span><span class="p">,</span> <span class="n">Resolution</span> <span class="n">time</span> <span class="mi">4</span><span class="p">,</span><span class="mi">505</span><span class="n">s</span><span class="p">,</span> <span class="mi">71596</span> <span class="n">Nodes</span> <span class="p">(</span><span class="mi">15</span> <span class="mi">892</span><span class="p">,</span><span class="mi">4</span> <span class="n">n</span><span class="o">/</span><span class="n">s</span><span class="p">),</span> <span class="mi">143169</span> <span class="n">Backtracks</span><span class="p">,</span> <span class="mi">71573</span> <span class="n">Fails</span><span class="p">,</span> <span class="mi">0</span> <span class="n">Restarts</span>
</pre></div>
</div>
<p>We can see that more intermediate solutions were found (12 vs. 7) and
that it took more time to find the best solution (514ms and 2147 nodes vs. 326ms and 906 nodes)
but the optimality is proven faster (4,505s and 71596 nodes vs. 12,608s and 246096 nodes).</p>
<p>This demonstrates that a strategy that is quick to produce the best solution may be unable to prove its optimality efficiently.</p>
</div>
<div class="section" id="things-to-remember">
<h2>Things to remember<a class="headerlink" href="#things-to-remember" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>A good estimation of the variables domain is important to limit overflow and reduce the induce search space.</li>
<li>Redundant constraints can reduce the search space too, but can also slow down the propagation loop. Their benefit
should be evaluated.</li>
<li>Most of the time adding clauses instead of logical constraints limits the memory footprint and provide an equivalent
filtering quality.</li>
<li>A decision, result of a search strategy, is a combination of a variable, a value and an operator.</li>
<li>Monitors can be plugged to the solver to interact with the search, specifically on solution.</li>
<li>Accurate search strategy design is the key to efficient resolution.</li>
</ul>
<p><a class="reference external" href="502.mathmodel.html">&lt;&lt;mathematical model</a></p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">choco-tuto</a></h1>





<p>
<iframe src="https://ghbtns.com/github-btn.html?user=&repo=&type=watch&count=true&size=large"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>




<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="001.introduction.html">Introduction to choco-tuto</a></li>
<li class="toctree-l1"><a class="reference internal" href="002.history.html">Choco, a constraint programming java library</a></li>
<li class="toctree-l1"><a class="reference internal" href="003.installation.html">Installation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="201.firstexample.html">A first example</a></li>
<li class="toctree-l1"><a class="reference internal" href="202.objects.html">Objects in Choco</a></li>
<li class="toctree-l1"><a class="reference internal" href="203.firstexample2.html">Playing around with 8-queens puzzle</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="301.description.html">Verbal arithmetic</a></li>
<li class="toctree-l1"><a class="reference internal" href="401.description.html">Warehouse Location Problem</a></li>
<li class="toctree-l1"><a class="reference internal" href="501.description.html">Aircraft Landing Problem</a></li>
<li class="toctree-l1"><a class="reference internal" href="601.description.html">Nonogram</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Charles Prud'homme.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.7</a>
      
      |
      <a href="../_sources/src/503.code.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>